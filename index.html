<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hội Nghị Công Đoàn</title>
    <!-- Load Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Font Awesome for icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    <style>
        :root {
            --primary-blue: #0056b3; /* Xanh Công Đoàn */
            --secondary-red: #cc0000; /* Đỏ tương tác */
            --soft-yellow: #fdfae5; /* Nền vàng nhạt */
            --text-color: #1a202c;
        }

        /* ĐIỀU CHỈNH FONT THEO YÊU CẦU: SỬ DỤNG FONT TAHOMA PHỔ BIẾN */
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background-color: var(--soft-yellow);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            overflow-x: hidden; 
        }

        /* ------------------------------------- */
        /* 3D FLIP CONTAINER STYLING */
        /* ------------------------------------- */
        .flip-container {
            width: 100%;
            max-width: 900px;
            height: auto; /* Tự động điều chỉnh chiều cao theo nội dung */
            min-height: 70vh; /* Chiều cao tối thiểu */
            perspective: 1500px; 
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s ease-in-out; 
            transform-origin: center right; 
        }
        
        .flip-active {
            transform: translateX(-100%) rotateY(-180deg);
            height: 80vh; /* Cố định chiều cao khi lật để hiệu ứng 3D hoạt động */
            min-height: 550px;
        }

        .scene {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-bottom: 50px;
        }
        
        /* Front Face (Menu) */
        .menu-scene {
            z-index: 2;
            padding-top: 20px;
            /* Đảm bảo menu cuộn được nếu quá dài */
            overflow-y: auto; 
            height: auto;
        }

        /* Back Face (Document Reader) */
        .doc-scene {
            transform: rotateY(180deg);
            background-color: #f7f7f7; 
            color: #333;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            overflow-y: hidden; 
        }

        /* ------------------------------------- */
        /* MENU & CARD STYLING */
        /* ------------------------------------- */
        .banner-container {
            width: 100%;
            max-width: 900px;
            margin-bottom: 30px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .banner-image {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover; 
            border-radius: 16px;
        }

        .menu-card {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            font-weight: 600;
            border-radius: 12px;
            text-align: center;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0, 0, 0, 0.05);
            cursor: pointer;
            user-select: none; 
            min-height: 120px; 
        }

        .menu-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .menu-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        /* PHONG CÁCH TƯƠNG TÁC (ĐỎ) - Đã đồng bộ font */
        .interactive-card {
            background-color: var(--secondary-red); 
            border: 2px solid var(--secondary-red);
        }
        .interactive-card:hover {
            background-color: #e62e2e;
        }
        .interactive-card .menu-icon {
             color: white; 
        }
        
        /* PHONG CÁCH TÀI LIỆU (XANH CÔNG ĐOÀN) */
        .document-card {
            background-color: var(--primary-blue); 
            color: white; 
            border: 2px solid var(--primary-blue);
        }
        .document-card:hover {
            background-color: #004a99; 
        }
        .document-card .menu-icon {
            color: #d1d5db; 
        }

        /* Divider */
        .menu-divider {
            height: 3px;
            background-color: var(--secondary-red);
            margin: 40px auto;
            width: 50px;
            border-radius: 2px;
        }
        
        /* ------------------------------------- */
        /* DOCUMENT READER STYLING */
        /* ------------------------------------- */
        .doc-viewer {
            width: 100%;
            /* Tính toán lại chiều cao để vừa vặn trong scene 2 */
            height: calc(100% - 70px); 
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .doc-viewer iframe {
            width: 100%;
            height: 100%; 
            border: none;
        }
        
        /* Cố định menu header trên mobile */
        @media (max-width: 900px) {
            .flip-active {
                height: 90vh; /* Tăng chiều cao khi lật trên mobile */
            }
        }
    </style>
</head>
<body>
    
    <!-- Header: Hidden Sound Toggle as per request -->
    <div class="w-full max-w-4xl px-4 flex justify-end gap-4 mb-4">
        <!-- Nút Bật/Tắt Âm Thanh - ĐÃ ẨN/LOẠI BỎ CHỨC NĂNG ÂM THANH -->
        <button id="soundToggle" class="hidden"></button>
    </div>

    <!-- MAIN 3D CONTAINER -->
    <div class="flip-container" id="flipContainer">
        
        <!-- FACE 1: MAIN MENU -->
        <div class="scene menu-scene w-full max-w-4xl px-4" id="mainMenu">
            <div class="banner-container">
                <!-- Banner Image - Đã sửa lỗi đường dẫn tĩnh -->
                <img id="bannerImage" src="" alt="Banner Hội Nghị Đại Biểu Công Đoàn Phường Hiệp Bình" class="banner-image">
            </div>

            <div class="menu-grid w-full">
                
                <!-- PHÂN NHÓM 1: CHỨC NĂNG TƯƠNG TÁC -->
                <h3 class="text-2xl font-bold mb-6 text-center text-gray-700 uppercase tracking-wider">CHỨC NĂNG TƯƠNG TÁC</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- Điểm danh - Nền Đỏ, Chữ TRẮNG (Font đã được kế thừa từ body) -->
                    <a href="https://script.google.com/macros/s/AKfycbz7Mm3kZx45LfNcfURZxbGLZ3hNAligHtJV1cQYq8N3hwcRTl_kF4Qcl4WhMNVOrdTy3A/exec" target="_blank" class="menu-card interactive-card text-white">
                        <i class="fas fa-user-check menu-icon text-white"></i>
                        <span class="text-xl font-extrabold">ĐIỂM DANH THAM DỰ</span>
                        <span class="text-sm mt-1 font-normal opacity-90">Truy cập link Điểm danh</span>
                    </a>
                    
                    <!-- Biểu quyết - Nền Đỏ, Chữ VÀNG (Font đã được kế thừa từ body) -->
                    <a href="https://forms.gle/y6KZJWgarXy16ogN8" target="_blank" class="menu-card interactive-card text-yellow-300">
                        <i class="fas fa-poll-h menu-icon text-yellow-300"></i>
                        <span class="text-xl font-extrabold">BIỂU QUYẾT HỆ THỐNG CHỈ TIÊU</span>
                        <span class="text-sm mt-1 font-normal opacity-90">Truy cập Google Form</span>
                    </a>
                </div>

                <div class="menu-divider"></div>

                <!-- PHÂN NHÓM 2: TÀI LIỆU HỘI NGHỊ - Nền XANH CÔNG ĐOÀN, Chữ TRẮNG -->
                <h3 class="text-2xl font-bold mb-6 text-center text-gray-700 uppercase tracking-wider">TÀI LIỆU HỘI NGHỊ</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <!-- Hàng 1 -->
                    <div data-doc-title="CHƯƠNG TRÌNH HỘI NGHỊ" data-doc-url="pdf/ChuongTrinh.pdf" class="menu-card document-card">
                        <i class="fas fa-calendar-alt menu-icon"></i>
                        CHƯƠNG TRÌNH HỘI NGHỊ
                    </div>
                    <div data-doc-title="QUY CHẾ HỘI NGHỊ" data-doc-url="pdf/QuyChe.pdf" class="menu-card document-card">
                        <i class="fas fa-balance-scale-right menu-icon"></i>
                        QUY CHẾ HỘI NGHỊ
                    </div>

                    <!-- Hàng 2 -->
                    <div data-doc-title="DỰ THẢO BÁO CÁO KẾT QUẢ HOẠT ĐỘNG" data-doc-url="pdf/BaoCao.pdf" class="menu-card document-card">
                        <i class="fas fa-file-alt menu-icon"></i>
                        DỰ THẢO BÁO CÁO KẾT QUẢ HOẠT ĐỘNG
                    </div>
                    <div data-doc-title="DỰ THẢO PHƯƠNG HƯỚNG" data-doc-url="pdf/PhuongHuong.pdf" class="menu-card document-card">
                        <i class="fas fa-compass menu-icon"></i>
                        DỰ THẢO PHƯƠNG HƯỚNG
                    </div>

                    <!-- Hàng 3 -->
                    <div data-doc-title="DỰ THẢO BÁO CÁO GÓP Ý" data-doc-url="pdf/GopY.pdf" class="menu-card document-card">
                        <i class="fas fa-comments menu-icon"></i>
                        DỰ THẢO BÁO CÁO GÓP Ý
                    </div>
                    <div data-doc-title="PHỤ LỤC HỆ THỐNG CHỈ TIÊU" data-doc-url="pdf/ChiTieu.pdf" class="menu-card document-card">
                        <i class="fas fa-chart-line menu-icon"></i>
                        PHỤ LỤC HỆ THỐNG CHỈ TIÊU
                    </div>

                    <!-- Hàng 4 -->
                    <div data-doc-title="PHỤ LỤC GỢI Ý THẢO LUẬN" data-doc-url="pdf/ThaoLuan.pdf" class="menu-card document-card col-span-1 md:col-span-2 max-w-sm mx-auto">
                        <i class="fas fa-lightbulb menu-icon"></i>
                        PHỤ LỤC GỢI Ý THẢO LUẬN
                    </div>

                </div>
            </div>

            <footer class="mt-12 text-gray-500 text-sm w-full text-center">
                © Công Đoàn Phường Hiệp Bình - Nhiệm kỳ 2025-2030
            </footer>

        </div>
        
        <!-- FACE 2: DOCUMENT READER -->
        <div class="scene doc-scene w-full max-w-4xl">
            
            <!-- Nút Trở Về Menu Chính -->
            <div class="flex justify-between items-center w-full mb-4 sticky top-0 bg-white p-2 rounded-lg shadow-md z-10">
                <button id="backButton" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 hover:bg-red-700 shadow-xl flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i>
                    TRỞ VỀ MENU CHÍNH
                </button>
                <h2 id="docTitle" class="text-xl font-extrabold text-red-700 text-right truncate ml-4">TÊN TÀI LIỆU</h2>
            </div>

            <!-- Khung hiển thị PDF (Dùng iframe để nhúng PDF) -->
            <div class="doc-viewer flex-grow">
                <!-- iframe sẽ được cập nhật src bằng Blob URL -->
                <iframe id="pdfViewer" src="" allowfullscreen></iframe>
            </div>

        </div>
    </div>

    <script>
        // --- CHỨC NĂNG TỰ ĐỘNG XÁC ĐỊNH BASE_PATH CHO GITHUB PAGES (Tối ưu nhất) ---
        function getBasePath() {
            const pathParts = window.location.pathname.split('/').filter(p => p.length > 0);
            
            if (window.location.hostname.endsWith('github.io') && pathParts.length > 0) {
                // Trên GitHub Pages (username.github.io/repo-name/)
                // BASE_PATH sẽ là /repo-name/
                return '/' + pathParts[0] + '/';
            } else if (window.location.hostname.endsWith('github.io') && pathParts.length === 0) {
                 // Trường hợp đặc biệt: Custom domain trên GitHub Pages (congdoanphuonghiepbinh.github.io)
                 return '/';
            }
            // Môi trường Local hoặc Hosting truyền thống
            return '/';
        }

        const BASE_PATH = getBasePath();

        // Khởi tạo các biến DOM
        const flipContainer = document.getElementById('flipContainer');
        const pdfViewer = document.getElementById('pdfViewer');
        const docTitle = document.getElementById('docTitle');
        const backButton = document.getElementById('backButton');
        const menuItems = document.querySelectorAll('.document-card'); 
        const bannerImage = document.getElementById('bannerImage');
        
        // --- XỬ LÝ BANNER ---
        function loadBanner() {
            // Tải Banner: sử dụng đường dẫn tuyệt đối chính xác
            const fullBannerPath = BASE_PATH + "assets/Picture1.png";
            bannerImage.src = fullBannerPath;

            // Fallback nếu đường dẫn tuyệt đối vẫn lỗi (chuyển sang đường dẫn tương đối)
            bannerImage.onerror = function() {
                this.src = "assets/Picture1.png"; // Sử dụng đường dẫn tương đối không có dấu chấm (cách tốt nhất)
                this.onerror = null; 
            }
        }
        
        // --- CHỨC NĂNG CHÍNH: LẬT TRANG VÀ TẢI PDF ---
        
        // Hàm tải và hiển thị PDF
        async function loadAndFlipToPDF(relativePath, title) {
            // Xây dựng URL đầy đủ bằng cách sử dụng đường dẫn cơ sở
            const fullUrl = BASE_PATH + relativePath; 
            
            try {
                // 1. Lấy dữ liệu PDF bằng fetch
                const response = await fetch(fullUrl);
                if (!response.ok) {
                    throw new Error(`Tệp ${relativePath} không tìm thấy (Lỗi ${response.status}). Vui lòng kiểm tra tên tệp.`);
                }
                const blob = await response.blob();
                
                // 2. Tạo URL cục bộ từ Blob
                const pdfUrl = URL.createObjectURL(blob);
                
                // 3. Cập nhật nội dung
                docTitle.textContent = title;
                // Cố gắng sử dụng URL.createObjectURL cho iframe
                pdfViewer.src = pdfUrl + '#toolbar=0&navpanes=0&scrollbar=0'; 
                
                // 4. Kích hoạt hiệu ứng lật trang 3D
                // Điều chỉnh chiều cao của container khi lật
                const currentHeight = document.documentElement.clientHeight * 0.9; // Lấy 90% chiều cao màn hình
                flipContainer.style.height = `${currentHeight}px`;
                flipContainer.style.minHeight = `${Math.min(currentHeight, 550)}px`;
                flipContainer.classList.add('flip-active');
                
            } catch (error) {
                console.error("Lỗi tải PDF:", error);
                
                // Cung cấp tùy chọn mở tab mới làm fallback, sử dụng đường dẫn tuyệt đối
                const fallbackUrl = window.location.origin + BASE_PATH + relativePath;
                if(confirm(`LỖI TẢI TÀI LIỆU (${error.message}). Bạn có muốn mở tài liệu này trong tab mới không?`)) {
                     window.open(fallbackUrl, '_blank');
                }
            }
        }

        // Gắn sự kiện cho các menu tài liệu
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                const relativePath = this.getAttribute('data-doc-url');
                const title = this.getAttribute('data-doc-title');
                loadAndFlipToPDF(relativePath, title);
            });
        });

        // Xử lý nút Trở về
        backButton.addEventListener('click', () => {
            // 1. Lật trang 3D ngược lại
            flipContainer.classList.remove('flip-active');
            
            // 2. Khôi phục chiều cao linh hoạt cho menu chính
            setTimeout(() => {
                flipContainer.style.height = 'auto';
                flipContainer.style.minHeight = '70vh';

                // Dọn dẹp PDF viewer
                const currentBlobUrl = pdfViewer.src;
                pdfViewer.src = ''; 
                if (currentBlobUrl.startsWith('blob:')) {
                    URL.revokeObjectURL(currentBlobUrl);
                }
            }, 800); // Đợi hiệu ứng 3D kết thúc
        });

        // Khởi động
        window.onload = loadBanner;

    </script>
</body>
</html>
